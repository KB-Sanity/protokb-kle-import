(function(e,l){typeof exports=="object"&&typeof module<"u"?module.exports=l():typeof define=="function"&&define.amd?define(l):(e=typeof globalThis<"u"?globalThis:e||self,e["protokb-kle-import"]=l())})(this,function(){"use strict";var k=Object.defineProperty;var K=(e,l,i)=>l in e?k(e,l,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[l]=i;var u=(e,l,i)=>(K(e,typeof l!="symbol"?l+"":l,i),i);const e=[["topLeft","bottomLeft","topRight","bottomRight","frontLeft","frontRight","left","right","top","center","bottom","front"],["top","bottom",null,null,"frontLeft","frontRight","center",null,null,null,null,"front"],["left",null,"right",null,"frontLeft","frontRight",null,null,"center",null,null,"front"],["center",null,null,null,"frontLeft","frontRight",null,null,null,null,null,"front"],["topLeft","bottomLeft","topRight","bottomRight","front",null,"left","right","top","center","bottom",null],["top","bottom",null,null,"front",null,"center",null,null,null,null,null],["left",null,"right",null,"front",null,null,null,"center",null,null,null],["center",null,null,null,"front",null,null,null,null,null,null,null]];function*l(h){var c,s,a;const t={x:0,y:0,rx:0,ry:0,h:1,w:1,a:4,c:"#cccccc",t:"#000000"},r={x:0,y:0};for(const o of h){if(!Array.isArray(o)){yield{...o};continue}for(const n of o)if(typeof n=="object")"rx"in n&&(t.rx=r.x=n.rx,t.x=r.x,t.y=r.y),"ry"in n&&(t.ry=r.y=n.ry,t.x=r.x,t.y=r.y),n.x&&(t.x+=n.x),n.y&&(t.y+=n.y),"r"in n&&(t.r=n.r),"w"in n&&(t.w=n.w),"h"in n&&(t.h=n.h),"h2"in n&&!("h"in n)?t.h=n.h2:"h2"in n&&(t.h2=n.h2),"w2"in n&&!("w"in n)?t.w=n.w2:"w2"in n&&(t.w2=n.w2),"a"in n&&(t.a=n.a),"c"in n&&(t.c=n.c),"t"in n&&(t.t=n.t);else{const w={x:t.x,y:t.y},p={width:t.w||t.w2||1,height:t.h||t.h2||1},m={x:(c=t.rx)!=null?c:0,y:(s=t.ry)!=null?s:0},b=(a=t.r)!=null?a:0,y={};if(n.length){const d=n.split(`
`),L=t.t.split(`
`),R=e[t.a];for(let f=0;f<d.length;f++){const g=d[f],x=R[f];g.length&&x&&(y[x]={text:g,color:L[f]||"#000000"})}}yield{position:w,size:p,pivot:m,angle:b,legends:y,color:t.c},t.x+=p.width,t.w=t.h=1,t.x2=t.y2=t.w2=t.h2=0}++t.y,t.x=t.rx}}class i{constructor(t){u(this,"_handleImportKleLayout",()=>{this.api.utils.pickFile("application/JSON").then(t=>{const r=new FileReader;r.onload=c=>{const s=c.target;if(s.result){const a=JSON.parse(s.result);for(const o of l(a))"position"in o?this.api.layoutEditor.getKeyboard().addKeyCap({position:o.position,size:o.size,pivot:o.pivot,angle:o.angle,legends:o.legends,color:o.color}):this.api.layoutEditor.getKeyboard().setMetadata(o)}},r.readAsText(t)})});this.api=t,t.toolbar.registerButtons(this,[{name:"Import KLE layout",icon:"Download",onClick:this._handleImportKleLayout}])}}return u(i,"title","KLE Import"),u(i,"description","Proto KB plugin that allow to import KLE layouts"),u(i,"id","com.protokb.kle_import"),i});
